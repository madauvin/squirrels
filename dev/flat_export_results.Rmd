---
title: "flat_export_results.Rmd empty"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r development, include=FALSE}
library(testthat)
library(tools)
library(utils)
```

```{r development-load}
# Load already included functions if relevant
pkgload::load_all(export_all = FALSE)
```

# Sauvegarder et exporter les résultats dans un document csv





```{r dev}

df <- iris
path<- "test"

```

```{r function-export_results}
#' export  file
#'
#' save as CSV
#' @param df 
#' @param mypath le chemin où enregistrer mon df
#' @param ... 
#' @importFrom utils write.csv2
#' @importFrom tools file_ext
#' @return le chemin d'enregistrement
#' @export
#'
#' @examples
save_as_csv <- function(df, mypath, ...) {
  # Créer un dossier temporaire pour le fichier CSV
  mon_dossier_temp <- tempfile(pattern = "saveascsv")
  dir.create(mon_dossier_temp)
  mypath <- file.path(mon_dossier_temp, "output.csv")

  # Vérifier si df est un data frame
  if (!is.data.frame(df)) {
    stop("df is not a data frame")
  }

  # Vérifier si df est vide
  if (nrow(df) == 0) {
    stop("df is an empty dataframe")
  }

  # Vérifier si mypath est un fichier CSV
  if (file_ext(mypath) != "csv") {
    stop("mypath must be a csv")
  }

  # Vérifier si le dossier de mypath existe
  if (!dir.exists(dirname(mypath))) {
    stop("my path does not exist")
  }
  write.csv2(x = df, file = mypath, ...)

  message("Finish: writing")
  return(mypath)
}

```

```{r examples-export_results}
df <- data.frame(a = 1:5, b = letters[1:5])

mypath <- save_as_csv(df, "output.csv", sep = ";", dec = ",", row.names = FALSE)

print(mypath)
```

```{r tests-export_results}
test_that("save_as_csv works", {
  expect_true(inherits(save_as_csv, "function")) 
  
  
mon_dossier_temp <- tempfile(pattern = "saveascsv")
dir.create(mon_dossier_temp)
mypath <- file.path(mon_dossier_temp, "output.csv")
  
})

```


```{r development-inflate, eval=FALSE}
# Run but keep eval=FALSE to avoid infinite loop
# Execute in the console directly
fusen::inflate(
  flat_file = "dev/flat_export_results.Rmd",
  vignette_name = "Exporter les résultats"
)
```

